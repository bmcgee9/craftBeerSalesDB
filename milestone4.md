# Documentation for Milestone 4
## Brett McGee

For the task 1 milestone 4, I performed 3 enhancements: migrating my database to AWS, creating a front end that allows users to query my DB, and creating an authentication system on the website. This page of documentation dives into how I accomplished all 3 of these enhancements, and then I will discuss some of the issues I ran into and the lessons I learned from them. <br>
### Enhancement 1: Migrating my database to AWS
To accomplish this, I followed the guide posted in the latest canvas announcement. First, I created a new RDS on AWS through the learner lab we have been using. I made sure to select it to run an image that used mySQL, and I made sure that it could be accessed through the internet. Still in the AWS portal, I went to the security group that my RDS was a part of and made sure that it allowed traffic from anywhere going to port 3306 which is the standard port that mySQL uses. I then went into mySQL Workbench on my local machine and used the "Data Export" tool under the "Databases" tab. This tool generated a `.sql` script that recreates the DB schemas and data in another mySQL database. Still in mySQL workbench on my laptop, I created another connection from the home page that allowed my to remotely connect to my craftbeerdb on my RDS through mySQL workbench. Once I had this connection set up, I simply just used the "Data Import" tool under the "Databases" tab and set it to run the script generated by the Data Export. This ran successfully the first time, and I ran a few sample queries to make sure all the data was there. Here is a picture of my craftbeerRDS and its schemas: <br> ![image](https://github.com/bmcgee9/craftBeerSalesDB/assets/102620872/fa0db86f-7313-4445-99eb-578a90122692) <br> In addition, you can see that I added a second schema, `auth`, which is used for my third enhancement and just contains one table with one username and password pair.


### Enhancement 2: Creating a Front End
First, check out this [link](enhancement.md) to explore the functionality of my front end so you can picture what I am discussing in this section. Here, I will just explain how I created it. Also, use this [link](html_CSS_PHP_Files/) to explore the code I wrote to make this possible. The first step in creating my front end, was creating an AWS ec2 server. Luckily, I already had an ec2 server set up with Red Hat Linux from a previous class lab, which means I didn't have to reinstall apache or other necessary services. The largest step in this process was designing my `index.html` page since it is the first page a user will see and must look nice. I learned how to create a navigation bar to link the three pages I planned on making. On `index.html`, I also added to query features. The first allows the user to search for a part of the name of the craft beer, and it returns a table of details about beers with names matching the search all nicely formatted with `tableStyle.css` . The second query allows the user to select a country from a large dropdown list and once they press submit, it returns a table that includes all of the vendors/breweries originating from the selected country. Both of these queries work by taking the input in a form and sending it as a POST request to a corresponding PHP file (`beerLookup.php` and `countryLookup.php` respectively). Here is a picture example of the html code used to collect the input and send the POST request: <br> ![image](https://github.com/bmcgee9/craftBeerSalesDB/assets/102620872/c2d001b8-48ef-4c86-ab06-38672f96e834) <br>
Once the POST request was sent to its respective PHP file, I used `mysqli` to remotely and automatically run a query on my RDS and return the results in a variable. I then formatted this result variable into a table that the user can see. Here is a picture of the PHP code used to connect to and query the RDS: <br> ![image](https://github.com/bmcgee9/craftBeerSalesDB/assets/102620872/24d9a9b6-ddef-4c03-a421-2deb6daeb257) <br>
After I finsihed out these querying features on the home page (`index.html`), I created my next page on the navigation bar, `about.html` which just contains a small introduction and background to my project and essentially just directs the user to this repository.<br>
The last tab on my navigation bar is titled "Transactions Table" is where the authentication feature comes into play.

### Enhancement 3: Adding Authentication
For my third enhancement, I created an authentication system using html, PHP, and another small database on my RDS. The code for this can also be found at this [link](html_CSS_PHP_Files/). After selecting the "Transactions Table" tab, the user is redirected to my `login.html` page that is a very simple page that just has the user submit a username and password so that `login.html` can send a POST request to my `login.php` page that validates the credentials. Here is a picture of the code for collecting the username and password: <br> ![image](https://github.com/bmcgee9/craftBeerSalesDB/assets/102620872/d1e9c48b-5e40-4817-81ec-1a86048d7824) <br>
Once the POST request is sent to `login.php`, the PHP script initializes a connection with my RDS to query the `auth` schema for a username that matches the submitted one. If the query returns a password (meaning the inputted user exists), the password inputted by the user is checked against the password in the DB. Here is a peak at the PHP code used for authentication: <br> ![image](https://github.com/bmcgee9/craftBeerSalesDB/assets/102620872/df66451b-25b5-41b7-b340-7f1c70db2e04) <br>
If the credentials are valid, I set the `$_SESSION` authentication status to true and redirect the user to the `transactionsGive.php` page that displays the full table of my transactions which is formatted in a consistent way with the other tables. 


### Issues and Solutions and Lessons Learned
1. I couldn't figure out how to migrate my DB into a MariaDB instance on the ec2 server I was using for my website.
2. I was having trouble figuring out where the IP was on my RDS dashboard, but I then learned that you get a static url to connect to your RDS instead of an IP because the public IP is changing everytime it has to request an IP address from the AWS DHCP system.
3. I was having an extremely pesty connection issue between my servers while sending a POST request to the RDS server. I spent hours trying to debug it.
   I first went down the rabbit hole of making sure I was allowing HTTP, SQL(port 3306), and ICMP traffic and eventually all traffic between the two security groups that the servers were in, but this did nothing to help the issue.
   Eventually, after searching through a lot of online forums, I found that the issue was with the version of SELinux (Security Enhanced Linux) that my ec2 server was running not allowing certain connections.
   The solution was to run this line: `setsebool -P httpd_can_network_connect=1`. Here is the [link](https://stackoverflow.com/questions/3407281/mysqli-connect-problem) to the forum I used to solve this issue.
